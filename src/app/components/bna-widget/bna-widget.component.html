<!--*ngIf="(dataLoaded$ | async)"-->
<div class="table-responsive" *ngIf="(dataLoaded$ | async)">
  <table class="table table-bordered" #rootCauseAnalysisTable *ngIf="configuration as rootCauseAnalysisConfiguration">
    <!--*ngIf="configuration as rootCauseAnalysisConfiguration"-->
    <thead>
      <tr class="text-muted table-header">
        <td width="1%">#</td>
        <td width="{{
            100 / (rootCauseAnalysisConfiguration.dataElements.length + 1)
          }}%" [hidden]="dataElement.isHidden" *ngFor="
            let dataElement of rootCauseAnalysisConfiguration.dataElements
          ">
          {{ dataElement.name }}
        </td>
        <td width="1%">Actions</td>
      </tr>
    </thead>
    <!--<tbody>-->
    <tbody *ngIf="rootCauseAnalysisData" [@listEnter]>
      <tr [ngClass]="{'orphaned': dataItem.isOrphaned && !toBeDeleted[dataItem.id]}" *ngFor="
          let dataItem of rootCauseAnalysisData;
          let i = index;
          trackBy: dataItem?.id
        "
        [matTooltip]="dataItem.isOrphaned ? '(Indicator used seems to not be among bottleneck chart indicators)' : '' +  'Right click for edit/delete options'">
        <td>{{ i + 1 }}</td>
        <td [hidden]="dataElement.isHidden || toBeDeleted[dataItem.id]"
          *ngFor="let dataElement of rootCauseAnalysisConfiguration.dataElements; let j = index"
          [ngClass]="{ 'auto-filled': dataElement.valueType == 'AUTO_FILLED' && !dataItem.isOrphaned }">
          <app-data-item [dataElement]="dataElement" [dataValues]="dataItem.dataValues" [isActive]="dataItem.isActive"
            (dataValueUpdate)="onDataValueUpdate($event, dataItem)" [selectionList]="routerParams?.groups">
          </app-data-item>
        </td>
        <td class="p-1">
          <ng-container *ngIf="!dataItem.isActive">
            <button mat-icon-button [matMenuTriggerFor]="menu">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="onToggleEdit($event, dataItem)">
                <mat-icon>edit</mat-icon>
                <span>Edit</span>
              </button>
              <button mat-menu-item (click)="onToggleDelete($event, dataItem)">
                <mat-icon>delete</mat-icon>
                <span>Delete</span>
              </button>
            </mat-menu>
          </ng-container>
          <button *ngIf="dataItem.isActive" mat-flat-button color="primary"
            (click)="onDoneEditing($event, dataItem)">Done</button>
        </td>
        <td class="delete-message" *ngIf="toBeDeleted[dataItem.id]" colspan="100%">
          Are you sure wish to delete this data? <br />
          <button class="btn btn-sm btn-success" (click)="onToggleCancelAction($event, dataItem, 'DELETE')">
            <i class="icon-cancel"></i> No</button>&nbsp;
          <button class="btn btn-sm btn-danger" (click)="onDeleteRootCauseAnalysisData(dataItem)">
            <i class="icon-ok-circled2"></i> Yes
          </button>
        </td>
      </tr>

      <tr *ngIf="appAuthorities.all || appAuthorities.addRootCause">
        <td class="p-1" [attr.colspan]="rootCauseAnalysisConfiguration?.dataElements?.length">
          <button class="text-muted" mat-icon-button matTooltip="Add Root cause"
            (click)="onToggleAddNewRootCauseAnalysisData(configuration)">
            <mat-icon>add</mat-icon>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div [@fadeInOut] *ngIf="(notification$ | async)?.message as notificationMessage">
  <app-widget-notification-bar (resetNotification)="onResetNotification($event)" [notification]="notificationMessage">
  </app-widget-notification-bar>
</div>

<div *ngIf="(!configurationLoaded$ | async) || !(dataLoaded$ | async)">
  <div class="d-flex my-1">
    <div class="flex-fill mx-1" *ngFor="let count of [1, 2, 3, 4, 5, 6, 7]">
      <app-widget-item-loader [height]="'40px'"></app-widget-item-loader>
    </div>
  </div>
  <div class="d-flex my-1">
    <div class="flex-fill mx-1" *ngFor="let count of [1, 2, 3, 4, 5, 6, 7]">
      <app-widget-item-loader [height]="'40px'"></app-widget-item-loader>
    </div>
  </div>
  <div class="d-flex justify-content-between my-2 mx-1">
    <div style="width: 150px;">
      <app-widget-item-loader [height]="'40px'"></app-widget-item-loader>
    </div>
    <div style="width: 150px;">
      <app-widget-item-loader [height]="'40px'"></app-widget-item-loader>
    </div>
  </div>
</div>
